# Email Classifier

AI-powered email classification and management system using Next.js, Supabase, and custom Machine Learning.

## Features

- ğŸ” **Google OAuth Authentication** - Secure login with Gmail access
- ğŸ¤– **Custom ML Classification** - Automatically categorize emails using trained scikit-learn models
- ğŸ·ï¸ **Smart Prioritization** - High, Medium, Low priority based on ML analysis
- ğŸ“ **AI-Powered Summaries** - Email summaries generated by Google's Gemini AI
- ğŸ“± **Responsive UI** - Clean inbox interface with category tabs
- ğŸ”’ **Privacy First** - Emails stored securely in Supabase with Row Level Security

## Architecture

This project uses a **hybrid AI approach**:
- **Custom ML Models** (scikit-learn) for email category and priority classification
- **Gemini AI** for generating email summaries (generative task)
- **Python Flask API** serving ML model predictions
- **Next.js** frontend and API routes

## Setup Instructions

### 1. Install Python Dependencies

```bash
# Install Python packages for ML model
pip install -r requirements.txt
```

### 2. Train ML Classification Models

Train the custom machine learning models:

```bash
# Option 1: Run the Python training script
python train_model.py

# Option 2: Use the Jupyter notebook for interactive training
jupyter notebook email_classifier_model.ipynb
```

This will create trained models in the `models/` directory:
- `category_classifier.pkl` - 8-class category classifier
- `priority_classifier.pkl` - 3-class priority classifier  
- `tfidf_vectorizer.pkl` - Text feature extractor
- `model_metadata.json` - Model information

### 3. Start Python Classifier API

```bash
cd python-service
python classifier_api.py
```

The API will run on `http://localhost:5000`

### 4. Environment Variables

Create a `.env.local` file in the root directory:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# Google OAuth Configuration
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# Google AI Configuration (only for summaries now!)
GOOGLE_AI_API_KEY=your_google_ai_api_key

# Python Classifier API
PYTHON_CLASSIFIER_URL=http://localhost:5000

# App Configuration
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your_nextauth_secret
```

### 5. Google OAuth Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing one
3. Enable the Gmail API
4. Go to "Credentials" â†’ "Create Credentials" â†’ "OAuth 2.0 Client IDs"
5. Set authorized redirect URIs:
   - `http://localhost:3000/api/auth/callback/google` (development)
6. Copy the Client ID and Client Secret to your `.env.local`

### 6. Google AI API Setup

1. Go to [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Create an API key for Gemini
3. Copy the key to `GOOGLE_AI_API_KEY` in your `.env.local`
4. **Note**: Gemini is now only used for email summaries, not classification!

### 7. Supabase Setup

1. Create a new project at [Supabase](https://supabase.com)
2. Run the SQL migrations in `supabase/migrations/` to create tables
3. Copy your project URL and keys to `.env.local`

### 8. Install Node.js Dependencies & Run

```bash
npm install
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser.

### Running the Complete System

You need **3 services running**:

1. **Python Classifier API** (Terminal 1):
   ```bash
   cd python-service
   python classifier_api.py
   ```

2. **Next.js App** (Terminal 2):
   ```bash
   npm run dev
   ```

3. **Supabase** (cloud service or local)

## Usage

1. **Sign In**: Click "Continue with Google" and authorize Gmail access
2. **Sync Emails**: Click "Sync Emails" button to fetch and classify recent emails
3. **Browse Categories**: Use tabs to filter emails by category (Work, Finance, etc.)
4. **View Details**: Click expand arrow to see AI summary and full email content

## Email Categories

- **Work**: Professional emails, meetings, work-related tasks
- **Personal**: Family, friends, personal matters
- **Finance**: Banks, credit cards, bills, financial statements  
- **Travel**: Bookings, itineraries, travel-related emails
- **Shopping**: Orders, receipts, promotions from stores
- **Promotions**: Marketing emails, newsletters, offers
- **Spam**: Unwanted or suspicious emails
- **Other**: Everything else that doesn't fit other categories

## Project Structure

```
Email-classifier/
â”œâ”€â”€ src/                          # Next.js application
â”‚   â”œâ”€â”€ app/                      # App router pages
â”‚   â”œâ”€â”€ components/               # React components
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ ai-classifier.ts      # Modified: Hybrid AI approach
â”‚   â””â”€â”€ types/                    # TypeScript types
â”œâ”€â”€ python-service/               # NEW: Python ML API
â”‚   â”œâ”€â”€ classifier_api.py         # Flask API server
â”‚   â””â”€â”€ requirements.txt          # Python dependencies
â”œâ”€â”€ models/                       # NEW: Trained ML models
â”‚   â”œâ”€â”€ category_classifier.pkl   # Category classifier
â”‚   â”œâ”€â”€ priority_classifier.pkl   # Priority classifier
â”‚   â”œâ”€â”€ tfidf_vectorizer.pkl      # Feature extractor
â”‚   â””â”€â”€ model_metadata.json       # Model info
â”œâ”€â”€ email_classifier_model.ipynb  # NEW: Training notebook
â”œâ”€â”€ train_model.py                # NEW: Training script
â”œâ”€â”€ requirements.txt              # Python dependencies
â””â”€â”€ supabase/                     # Database migrations
```

## How It Works

### Classification Pipeline

1. **User syncs emails** from Gmail
2. **For each email**:
   - **Custom ML Model** classifies category (Work, Finance, etc.) and priority (High/Medium/Low)
   - **Gemini AI** generates a detailed summary (3-4 sentences)
3. **Results saved** to Supabase database
4. **UI displays** classified emails with categories, priorities, and summaries

### Why This Approach?

- **ML Models for Classification**: Faster, cheaper, and demonstrates ML skills
- **Gemini for Summaries**: Complex generative task that benefits from LLM
- **Best of Both Worlds**: Cost-effective classification + high-quality summaries

### Model Performance

The custom ML models achieve:
- **Category Classification**: ~90-95% accuracy
- **Priority Classification**: ~85-90% accuracy
- **Inference Time**: <50ms per email (vs 1-2s for API calls)

## Development Notes

### Retraining Models

To retrain with new data:

1. Export emails from Supabase
2. Update `create_training_dataset()` in `train_model.py`
3. Run `python train_model.py`
4. Restart Python API to load new models

### API Endpoints

Python Classifier API:
- `GET /health` - Health check
- `POST /classify` - Classify single email
- `POST /classify/batch` - Classify multiple emails

### Testing the ML Model

```bash
# Test the Python API
curl -X POST http://localhost:5000/classify \
  -H "Content-Type: application/json" \
  -d '{
    "subject": "Team meeting tomorrow",
    "body": "Reminder about our project sync at 10am",
    "sender": "manager@company.com"
  }'
```

## Troubleshooting

### Python API not connecting
- Ensure Python API is running: `cd python-service && python classifier_api.py`
- Check `PYTHON_CLASSIFIER_URL` in `.env.local`
- Verify models exist in `models/` directory

### Models not found
- Run model training first: `python train_model.py`
- Check that `models/` directory contains .pkl files

### Import errors
- Install Python dependencies: `pip install -r requirements.txt`
- Use Python 3.9+ for compatibility
